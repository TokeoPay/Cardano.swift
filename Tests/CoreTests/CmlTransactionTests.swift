import XCTest
#if !COCOAPODS
@testable import CardanoCore
#else
@testable import Cardano
#endif

import Foundation


final class CmlTransactionTests: XCTestCase {
    let initialize: Void = _initialize
    
    func test_merge_witness_set() throws {
        let txn = "84a400868258202792c2ff03aa4ce9667b049d64776e495f3a75c2cc4b0e979f5fb573ed5045e6018258200faf32b1214fada3bef919720c099adb249213c795b28d489c7316c07549095605825820e6150f3956d1bd527cf02935e8278f8c34fe63e0726c3cfecb561624e9c0e07a058258203f6873a19e9c802145787c2bb111cad62d1af708de8f9b46cbc4fc23818ea29a06825820a00d5137c76a9afdae2621cf31bf1f527fd68b59520405388d737948b8e1da1e03825820e6150f3956d1bd527cf02935e8278f8c34fe63e0726c3cfecb561624e9c0e07a03018282583901b43b148f9c0ed673ee20019cb3623d5d2bed7e2da001ea3096e2d9bf9c4bcdd7ff3cb4e66593f9274583b066fafdb22453774411602f901b1a005b8d8082583901289cb849c56ac050a19fc84f7cdfea36edb30100e141d5d6c59c6d5cfd34edf3440f0a8875be6f7998c59810aed6beab8426e773fa550a93821a0021d733a1581cab434d53b6bb2352714a8940d2a12db8e083c9bb7cd4dbff7080118fa648546f6b656f3034340148546f6b656f3130320148546f6b656f3130340148546f6b656f3232370148546f6b656f3339390148546f6b656f34303301021a0002c7cd0758201e8eb8575d879922d701c12daa7366cb71b6518a9500e083a966a8e66b56ed23a0f5a11902a2a1636d736765546f6b656f";
        
        let witness = "a100818258203a9396e952b3d7b4f24325b77199b2e0c2bd0f9d2797542a6b15320f4dd1f451584078df05ca3f501752e841defb5a7e0db35a7f59bdcdc54dc15b14440e5aa6c2d93a08425abbdc379a50cdfd8f47548b7b9d12ff8b909a008ca52afff184d92703"
        
        let result = try tx_merge_in_witness_set(transaction: Data(hex: txn)!, witness_set: Data(hex: witness)!)
        
        
        let expected_result = "84a400868258202792c2ff03aa4ce9667b049d64776e495f3a75c2cc4b0e979f5fb573ed5045e6018258200faf32b1214fada3bef919720c099adb249213c795b28d489c7316c07549095605825820e6150f3956d1bd527cf02935e8278f8c34fe63e0726c3cfecb561624e9c0e07a058258203f6873a19e9c802145787c2bb111cad62d1af708de8f9b46cbc4fc23818ea29a06825820a00d5137c76a9afdae2621cf31bf1f527fd68b59520405388d737948b8e1da1e03825820e6150f3956d1bd527cf02935e8278f8c34fe63e0726c3cfecb561624e9c0e07a03018282583901b43b148f9c0ed673ee20019cb3623d5d2bed7e2da001ea3096e2d9bf9c4bcdd7ff3cb4e66593f9274583b066fafdb22453774411602f901b1a005b8d8082583901289cb849c56ac050a19fc84f7cdfea36edb30100e141d5d6c59c6d5cfd34edf3440f0a8875be6f7998c59810aed6beab8426e773fa550a93821a0021d733a1581cab434d53b6bb2352714a8940d2a12db8e083c9bb7cd4dbff7080118fa648546f6b656f3034340148546f6b656f3130320148546f6b656f3130340148546f6b656f3232370148546f6b656f3339390148546f6b656f34303301021a0002c7cd0758201e8eb8575d879922d701c12daa7366cb71b6518a9500e083a966a8e66b56ed23a100818258203a9396e952b3d7b4f24325b77199b2e0c2bd0f9d2797542a6b15320f4dd1f451584078df05ca3f501752e841defb5a7e0db35a7f59bdcdc54dc15b14440e5aa6c2d93a08425abbdc379a50cdfd8f47548b7b9d12ff8b909a008ca52afff184d92703f5a11902a2a1636d736765546f6b656f"
        
        
        XCTAssertEqual(result.hex(prefix: false),expected_result, "Signed and Merged TX should be identical")
    }
    
    func testTxDetails() throws {
        
        let txn = "84a9008382582048be06cebaaed874f6a27ee61d7f2a18cd7efbbcc0c0708c73566825890700e60082582088dc1916f3579e97f41e5e0f4ba9c245e6179608f19f7e680d04ca8e8000a8970182582017ff24307d62c71cf06e7d9b7fe26e1eabf1af190204b819bbf714f03b30c9af0101868258390170e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a721e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005f1a000f4240825839019737419ac8cf4a69ac64440a1a734c2c50b18d423e499f289a5267d4bf1aacd8be15b54f3cb0837e92302e2040c89718973b5d8f763a03931a000f424082583901d2f63bb93a46252714598085271f2368e8669f8aaf8f5fab4e4fc2f5d6a3bf692f79c73710e92f431adf0bcb4aa17ecb0b3b126bb1defa5d1a002dc6c082583901a298fd66dc9060b11f0a8679cd8516ef14c31236c2dfb1a2ae933788131f44c4a43b3c6ea5b2aaf660d167f894fa133ae33d5cdc62a3d9f0821a002df852a7581c279c909f348e533da5808898f87f9a14bb2c3dfbbacccd631d927a3fa144534e454b1930ad581c693c3defceb1b7d27d1bf91f52b65b59b11b66b066d10c8d6d461f4ca154000de140515244414e4f5345525645523033323201581c77999d5a1e09f9bdc16393cab713f26345dc0827a9e5134cf0f9da37a24c4d756c67614b6f6e67333731014d4d756c67614b6f6e673338313901581c95a427e384527065f2f8946f5e86320d0117839a5e98ea2c0b55fb00a14448554e541a06052340581ca5b2464b242dcbc97c1f65e85753b04ba979645f693a806a394a4931a1494d69644b6e696768741a867e44fc581ca7bf4ce10dca4f5f99b081c4ea84e0e3f919775b953324e09edea852a14d536865446576696c733131363601581cba92e5f4665a026f7d5f2f223d398d2d8b649e147b5163b759bd61a0ad4a54696765727a32373739014a54696765727a33383630014a54696765727a33383631014a54696765727a33383632014a54696765727a33383633014a54696765727a33383634014a54696765727a33383635014a54696765727a33383636014a54696765727a33383637014a54696765727a33383638014a54696765727a33383639014a54696765727a33383730014a54696765727a333837310182583901a298fd66dc9060b11f0a8679cd8516ef14c31236c2dfb1a2ae933788131f44c4a43b3c6ea5b2aaf660d167f894fa133ae33d5cdc62a3d9f0821a001898a4a3581cba92e5f4665a026f7d5f2f223d398d2d8b649e147b5163b759bd61a0a24a54696765727a33383732014a54696765727a3532303301581cbb143df7e6472b158014023d8a1c592d38be8771ce4c01f4fcd65c63a148323630313235363301581cc72d0438330ed1346f4437fcc1c263ea38e933c1124c8d0f2abc6312a2484b5749433034303501484b574943313230340182583901a298fd66dc9060b11f0a8679cd8516ef14c31236c2dfb1a2ae933788131f44c4a43b3c6ea5b2aaf660d167f894fa133ae33d5cdc62a3d9f01a032e7f60021a0007465d031a074b3efa0b58204bcd043768b51437bc8087ffe6b740ada67f7a899d12c1445d28a00808ea79d80d8182582017ff24307d62c71cf06e7d9b7fe26e1eabf1af190204b819bbf714f03b30c9af011082583901a298fd66dc9060b11f0a8679cd8516ef14c31236c2dfb1a2ae933788131f44c4a43b3c6ea5b2aaf660d167f894fa133ae33d5cdc62a3d9f01a036900e0111a000ae98c12818258209a32459bd4ef6bbafdeb8cf3b909d0e3e2ec806e4cc6268529280b0fc1d06f5b00a2049fd8799f581cd2f63bb93a46252714598085271f2368e8669f8aaf8f5fab4e4fc2f59fd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a000f4240ffffd8799fd8799fd8799f581c9737419ac8cf4a69ac64440a1a734c2c50b18d423e499f289a5267d4ffd8799fd8799fd8799f581cbf1aacd8be15b54f3cb0837e92302e2040c89718973b5d8f763a0393ffffffffa140d8799f00a1401a000f4240ffffd8799fd8799fd8799f581cd2f63bb93a46252714598085271f2368e8669f8aaf8f5fab4e4fc2f5ffd8799fd8799fd8799f581cd6a3bf692f79c73710e92f431adf0bcb4aa17ecb0b3b126bb1defa5dffffffffa140d8799f00a1401a002dc6c0ffffffffff0581840001d87a80821a002f5dee1a34ddb004f5f6"
        let txnData = Data(hex: txn)
        
        assert(txnData != nil)
        
        let txDetails = try SwiftTxDetails(transaction: txnData!)
        
        let jsonEncoder = JSONEncoder()
        let jsonData = try jsonEncoder.encode(txDetails.inputs)
        
        let json = String(data: jsonData, encoding: String.Encoding.utf8)
        print("TxDetails", json)
        
        
    }
}
